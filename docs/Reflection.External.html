<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Reflection.External</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- Support for system calls as part of reflection</a>
<a id="156" class="Comment">------------------------------------------------------------------------</a>

<a id="230" class="Symbol">{-#</a> <a id="234" class="Keyword">OPTIONS</a> <a id="242" class="Pragma">--without-K</a> <a id="254" class="Pragma">--safe</a> <a id="261" class="Symbol">#-}</a>

<a id="266" class="Keyword">module</a> <a id="273" href="Reflection.External.html" class="Module">Reflection.External</a> <a id="293" class="Keyword">where</a>

<a id="300" class="Keyword">import</a> <a id="307" href="Agda.Builtin.Reflection.External.html" class="Module">Agda.Builtin.Reflection.External</a> <a id="340" class="Symbol">as</a> <a id="343" class="Module">Builtin</a>

<a id="352" class="Keyword">open</a> <a id="357" class="Keyword">import</a> <a id="364" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="378" class="Keyword">using</a> <a id="384" class="Symbol">(</a><a id="385" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="386" class="Symbol">;</a> <a id="388" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a><a id="391" class="Symbol">;</a> <a id="393" href="Agda.Builtin.Nat.html#210" class="InductiveConstructor">zero</a><a id="397" class="Symbol">;</a> <a id="399" href="Data.Nat.Base.html#2336" class="Function">NonZero</a><a id="406" class="Symbol">)</a>
<a id="408" class="Keyword">open</a> <a id="413" class="Keyword">import</a> <a id="420" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="435" class="Keyword">using</a> <a id="441" class="Symbol">(</a><a id="442" href="Agda.Builtin.List.html#148" class="Datatype">List</a><a id="446" class="Symbol">;</a> <a id="448" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">_∷_</a><a id="451" class="Symbol">;</a> <a id="453" href="Data.List.Base.html#9981" class="InductiveConstructor">[]</a><a id="455" class="Symbol">)</a>
<a id="457" class="Keyword">open</a> <a id="462" class="Keyword">import</a> <a id="469" href="Data.Product.html" class="Module">Data.Product</a> <a id="482" class="Keyword">using</a> <a id="488" class="Symbol">(</a><a id="489" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">_,_</a><a id="492" class="Symbol">)</a>
<a id="494" class="Keyword">open</a> <a id="499" class="Keyword">import</a> <a id="506" href="Data.String.Base.html" class="Module">Data.String.Base</a> <a id="523" class="Keyword">using</a> <a id="529" class="Symbol">(</a><a id="530" href="Agda.Builtin.String.html#336" class="Postulate">String</a><a id="536" class="Symbol">;</a> <a id="538" href="Data.String.Base.html#2177" class="Function Operator">_++_</a><a id="542" class="Symbol">)</a>
<a id="544" class="Keyword">open</a> <a id="549" class="Keyword">import</a> <a id="556" href="Data.Sum.html" class="Module">Data.Sum</a> <a id="565" class="Keyword">using</a> <a id="571" class="Symbol">(</a><a id="572" href="Data.Sum.Base.html#728" class="Datatype Operator">_⊎_</a><a id="575" class="Symbol">;</a> <a id="577" href="Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a><a id="581" class="Symbol">;</a> <a id="583" href="Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a><a id="587" class="Symbol">;</a> <a id="589" href="Data.Sum.Base.html#914" class="Function Operator">[_,_]</a><a id="594" class="Symbol">)</a>
<a id="596" class="Keyword">open</a> <a id="601" class="Keyword">import</a> <a id="608" href="Data.Unit.Base.html" class="Module">Data.Unit.Base</a> <a id="623" class="Keyword">using</a> <a id="629" class="Symbol">(</a><a id="630" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a><a id="631" class="Symbol">;</a> <a id="633" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a><a id="635" class="Symbol">)</a>
<a id="637" class="Keyword">open</a> <a id="642" class="Keyword">import</a> <a id="649" href="Function.html" class="Module">Function</a> <a id="658" class="Keyword">using</a> <a id="664" class="Symbol">(</a><a id="665" href="Function.Base.html#3709" class="Function Operator">case_of_</a><a id="673" class="Symbol">;</a> <a id="675" href="Function.Base.html#1577" class="Function Operator">_$_</a><a id="678" class="Symbol">;</a> <a id="680" href="Function.Base.html#992" class="Function Operator">_∘_</a><a id="683" class="Symbol">)</a>
<a id="685" class="Keyword">open</a> <a id="690" class="Keyword">import</a> <a id="697" href="Reflection.html" class="Module">Reflection</a> <a id="708" class="Keyword">hiding</a> <a id="715" class="Symbol">(</a><a id="716" href="Agda.Builtin.Reflection.html#3842" class="InductiveConstructor">name</a><a id="720" class="Symbol">)</a>

<a id="723" class="Comment">-- Type aliases for the various strings.</a>

<a id="CmdName"></a><a id="765" href="Reflection.External.html#765" class="Function">CmdName</a> <a id="773" class="Symbol">=</a> <a id="775" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
<a id="StdIn"></a><a id="782" href="Reflection.External.html#782" class="Function">StdIn</a>   <a id="790" class="Symbol">=</a> <a id="792" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
<a id="StdErr"></a><a id="799" href="Reflection.External.html#799" class="Function">StdErr</a>  <a id="807" class="Symbol">=</a> <a id="809" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
<a id="StdOut"></a><a id="816" href="Reflection.External.html#816" class="Function">StdOut</a>  <a id="824" class="Symbol">=</a> <a id="826" href="Agda.Builtin.String.html#336" class="Postulate">String</a>

<a id="834" class="Comment">-- |Helper function for throwing an error from reflection.</a>
<a id="userError"></a><a id="893" href="Reflection.External.html#893" class="Function">userError</a> <a id="903" class="Symbol">:</a> <a id="905" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="912" class="Symbol">→</a> <a id="914" href="Agda.Builtin.Reflection.html#7500" class="Postulate">TC</a> <a id="917" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a>
<a id="919" href="Reflection.External.html#893" class="Function">userError</a> <a id="929" href="Reflection.External.html#929" class="Bound">err</a> <a id="933" class="Symbol">=</a> <a id="935" href="Agda.Builtin.Reflection.html#7713" class="Postulate">typeError</a> <a id="945" class="Symbol">(</a><a id="946" href="Agda.Builtin.Reflection.html#7199" class="InductiveConstructor">strErr</a> <a id="953" href="Reflection.External.html#929" class="Bound">err</a> <a id="957" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="959" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="961" class="Symbol">)</a>

<a id="964" class="Comment">-- |Representation for exit codes, assuming 0 is consistently used to indicate</a>
<a id="1043" class="Comment">--  success across platforms.</a>
<a id="1073" class="Keyword">data</a> <a id="ExitCode"></a><a id="1078" href="Reflection.External.html#1078" class="Datatype">ExitCode</a> <a id="1087" class="Symbol">:</a> <a id="1089" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1093" class="Keyword">where</a>
  <a id="ExitCode.exitSuccess"></a><a id="1101" href="Reflection.External.html#1101" class="InductiveConstructor">exitSuccess</a> <a id="1113" class="Symbol">:</a> <a id="1115" href="Reflection.External.html#1078" class="Datatype">ExitCode</a>
  <a id="ExitCode.exitFailure"></a><a id="1126" href="Reflection.External.html#1126" class="InductiveConstructor">exitFailure</a> <a id="1138" class="Symbol">:</a> <a id="1140" class="Symbol">(</a><a id="1141" href="Reflection.External.html#1141" class="Bound">n</a> <a id="1143" class="Symbol">:</a> <a id="1145" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="1146" class="Symbol">)</a> <a id="1148" class="Symbol">{</a><a id="1149" href="Reflection.External.html#1149" class="Bound">n≢0</a> <a id="1153" class="Symbol">:</a> <a id="1155" href="Data.Nat.Base.html#2336" class="Function">NonZero</a> <a id="1163" href="Reflection.External.html#1141" class="Bound">n</a><a id="1164" class="Symbol">}</a> <a id="1166" class="Symbol">→</a> <a id="1168" href="Reflection.External.html#1078" class="Datatype">ExitCode</a>

<a id="1178" class="Comment">-- |Specification for a command.</a>
<a id="1211" class="Keyword">record</a> <a id="CmdSpec"></a><a id="1218" href="Reflection.External.html#1218" class="Record">CmdSpec</a> <a id="1226" class="Symbol">:</a> <a id="1228" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1232" class="Keyword">where</a>
  <a id="1240" class="Keyword">constructor</a> <a id="cmdSpec"></a><a id="1252" href="Reflection.External.html#1252" class="InductiveConstructor">cmdSpec</a>
  <a id="1262" class="Keyword">field</a>
    <a id="CmdSpec.name"></a><a id="1272" href="Reflection.External.html#1272" class="Field">name</a>  <a id="1278" class="Symbol">:</a> <a id="1280" href="Reflection.External.html#765" class="Function">CmdName</a>     <a id="1292" class="Comment">-- ^ Executable name (see ~/.agda/executables)</a>
    <a id="CmdSpec.args"></a><a id="1343" href="Reflection.External.html#1343" class="Field">args</a>  <a id="1349" class="Symbol">:</a> <a id="1351" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="1356" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="1363" class="Comment">-- ^ Command-line arguments for executable</a>
    <a id="CmdSpec.input"></a><a id="1410" href="Reflection.External.html#1410" class="Field">input</a> <a id="1416" class="Symbol">:</a> <a id="1418" href="Reflection.External.html#782" class="Function">StdIn</a>       <a id="1430" class="Comment">-- ^ Contents of standard input</a>

<a id="1463" class="Comment">-- |Result of running a command.</a>
<a id="1496" class="Keyword">record</a> <a id="Result"></a><a id="1503" href="Reflection.External.html#1503" class="Record">Result</a> <a id="1510" class="Symbol">:</a> <a id="1512" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1516" class="Keyword">where</a>
  <a id="1524" class="Keyword">constructor</a> <a id="result"></a><a id="1536" href="Reflection.External.html#1536" class="InductiveConstructor">result</a>
  <a id="1545" class="Keyword">field</a>
    <a id="Result.exitCode"></a><a id="1555" href="Reflection.External.html#1555" class="Field">exitCode</a> <a id="1564" class="Symbol">:</a> <a id="1566" href="Reflection.External.html#1078" class="Datatype">ExitCode</a> <a id="1575" class="Comment">-- ^ Exit code returned by the process</a>
    <a id="Result.output"></a><a id="1618" href="Reflection.External.html#1618" class="Field">output</a>   <a id="1627" class="Symbol">:</a> <a id="1629" href="Reflection.External.html#816" class="Function">StdOut</a>   <a id="1638" class="Comment">-- ^ Contents of standard output</a>
    <a id="Result.error"></a><a id="1675" href="Reflection.External.html#1675" class="Field">error</a>    <a id="1684" class="Symbol">:</a> <a id="1686" href="Reflection.External.html#799" class="Function">StdErr</a>   <a id="1695" class="Comment">-- ^ Contents of standard error</a>

<a id="1728" class="Comment">-- |Convert a natural number to an exit code.</a>
<a id="toExitCode"></a><a id="1774" href="Reflection.External.html#1774" class="Function">toExitCode</a> <a id="1785" class="Symbol">:</a> <a id="1787" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="1789" class="Symbol">→</a> <a id="1791" href="Reflection.External.html#1078" class="Datatype">ExitCode</a>
<a id="1800" href="Reflection.External.html#1774" class="Function">toExitCode</a> <a id="1811" href="Agda.Builtin.Nat.html#210" class="InductiveConstructor">zero</a>    <a id="1819" class="Symbol">=</a> <a id="1821" href="Reflection.External.html#1101" class="InductiveConstructor">exitSuccess</a>
<a id="1833" href="Reflection.External.html#1774" class="Function">toExitCode</a> <a id="1844" class="Symbol">(</a><a id="1845" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="1849" href="Reflection.External.html#1849" class="Bound">n</a><a id="1850" class="Symbol">)</a> <a id="1852" class="Symbol">=</a> <a id="1854" href="Reflection.External.html#1126" class="InductiveConstructor">exitFailure</a> <a id="1866" class="Symbol">(</a><a id="1867" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="1871" href="Reflection.External.html#1849" class="Bound">n</a><a id="1872" class="Symbol">)</a>

<a id="1875" class="Comment">-- |Quote an exit code as an Agda term.</a>
<a id="quoteExitCode"></a><a id="1915" href="Reflection.External.html#1915" class="Function">quoteExitCode</a> <a id="1929" class="Symbol">:</a> <a id="1931" href="Reflection.External.html#1078" class="Datatype">ExitCode</a> <a id="1940" class="Symbol">→</a> <a id="1942" href="Agda.Builtin.Reflection.html#4246" class="Datatype">Term</a>
<a id="1947" href="Reflection.External.html#1915" class="Function">quoteExitCode</a> <a id="1961" href="Reflection.External.html#1101" class="InductiveConstructor">exitSuccess</a> <a id="1973" class="Symbol">=</a>
  <a id="1977" href="Agda.Builtin.Reflection.html#4404" class="InductiveConstructor">con</a> <a id="1981" class="Symbol">(</a><a id="1982" class="Keyword">quote</a> <a id="1988" href="Reflection.External.html#1101" class="InductiveConstructor">exitSuccess</a><a id="1999" class="Symbol">)</a> <a id="2001" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>
<a id="2004" href="Reflection.External.html#1915" class="Function">quoteExitCode</a> <a id="2018" class="Symbol">(</a><a id="2019" href="Reflection.External.html#1126" class="InductiveConstructor">exitFailure</a> <a id="2031" href="Reflection.External.html#2031" class="Bound">n</a><a id="2032" class="Symbol">)</a> <a id="2034" class="Symbol">=</a>
  <a id="2038" href="Agda.Builtin.Reflection.html#4404" class="InductiveConstructor">con</a> <a id="2042" class="Symbol">(</a><a id="2043" class="Keyword">quote</a> <a id="2049" href="Reflection.External.html#1126" class="InductiveConstructor">exitFailure</a><a id="2060" class="Symbol">)</a> <a id="2062" class="Symbol">(</a><a id="2063" href="Reflection.Argument.html#1071" class="InductiveConstructor">vArg</a> <a id="2068" class="Symbol">(</a><a id="2069" href="Agda.Builtin.Reflection.html#4719" class="InductiveConstructor">lit</a> <a id="2073" class="Symbol">(</a><a id="2074" href="Agda.Builtin.Reflection.html#3672" class="InductiveConstructor">nat</a> <a id="2078" href="Reflection.External.html#2031" class="Bound">n</a><a id="2079" class="Symbol">))</a> <a id="2082" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="2084" href="Reflection.Argument.html#1126" class="InductiveConstructor">hArg</a> <a id="2089" class="Symbol">(</a><a id="2090" href="Agda.Builtin.Reflection.html#4404" class="InductiveConstructor">con</a> <a id="2094" class="Symbol">(</a><a id="2095" class="Keyword">quote</a> <a id="2101" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a><a id="2103" class="Symbol">)</a> <a id="2105" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="2107" class="Symbol">)</a> <a id="2109" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="2111" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="2113" class="Symbol">)</a>

<a id="2116" class="Comment">-- |Quote a result as an Agda term.</a>
<a id="quoteResult"></a><a id="2152" href="Reflection.External.html#2152" class="Function">quoteResult</a> <a id="2164" class="Symbol">:</a> <a id="2166" href="Reflection.External.html#1503" class="Record">Result</a> <a id="2173" class="Symbol">→</a> <a id="2175" href="Agda.Builtin.Reflection.html#4246" class="Datatype">Term</a>
<a id="2180" href="Reflection.External.html#2152" class="Function">quoteResult</a> <a id="2192" class="Symbol">(</a><a id="2193" href="Reflection.External.html#1536" class="InductiveConstructor">result</a> <a id="2200" href="Reflection.External.html#2200" class="Bound">exitCode</a> <a id="2209" href="Reflection.External.html#2209" class="Bound">output</a> <a id="2216" href="Reflection.External.html#2216" class="Bound">error</a><a id="2221" class="Symbol">)</a> <a id="2223" class="Symbol">=</a>
  <a id="2227" href="Agda.Builtin.Reflection.html#4404" class="InductiveConstructor">con</a> <a id="2231" class="Symbol">(</a><a id="2232" class="Keyword">quote</a> <a id="2238" href="Reflection.External.html#1536" class="InductiveConstructor">result</a><a id="2244" class="Symbol">)</a> <a id="2246" href="Function.Base.html#1577" class="Function Operator">$</a> <a id="2248" href="Reflection.Argument.html#1071" class="InductiveConstructor">vArg</a> <a id="2253" class="Symbol">(</a><a id="2254" href="Reflection.External.html#1915" class="Function">quoteExitCode</a> <a id="2268" href="Reflection.External.html#2200" class="Bound">exitCode</a><a id="2276" class="Symbol">)</a>
                     <a id="2299" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="2301" href="Reflection.Argument.html#1071" class="InductiveConstructor">vArg</a> <a id="2306" class="Symbol">(</a><a id="2307" href="Agda.Builtin.Reflection.html#4719" class="InductiveConstructor">lit</a> <a id="2311" class="Symbol">(</a><a id="2312" href="Agda.Builtin.Reflection.html#3808" class="InductiveConstructor">string</a> <a id="2319" href="Reflection.External.html#2209" class="Bound">output</a><a id="2325" class="Symbol">))</a>
                     <a id="2349" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="2351" href="Reflection.Argument.html#1071" class="InductiveConstructor">vArg</a> <a id="2356" class="Symbol">(</a><a id="2357" href="Agda.Builtin.Reflection.html#4719" class="InductiveConstructor">lit</a> <a id="2361" class="Symbol">(</a><a id="2362" href="Agda.Builtin.Reflection.html#3808" class="InductiveConstructor">string</a> <a id="2369" href="Reflection.External.html#2216" class="Bound">error</a><a id="2374" class="Symbol">))</a>
                     <a id="2398" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="2400" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

<a id="2404" class="Comment">-- |Run command from specification and return the full result.</a>
<a id="2467" class="Comment">--</a>
<a id="2470" class="Comment">--  NOTE: If the command fails, this macro still succeeds, and returns the</a>
<a id="2545" class="Comment">--        full result, including exit code and the contents of stderr.</a>
<a id="2616" class="Comment">--</a>
<a id="unsafeRunCmdTC"></a><a id="2619" href="Reflection.External.html#2619" class="Function">unsafeRunCmdTC</a> <a id="2634" class="Symbol">:</a> <a id="2636" href="Reflection.External.html#1218" class="Record">CmdSpec</a> <a id="2644" class="Symbol">→</a> <a id="2646" href="Agda.Builtin.Reflection.html#7500" class="Postulate">TC</a> <a id="2649" href="Reflection.External.html#1503" class="Record">Result</a>
<a id="2656" href="Reflection.External.html#2619" class="Function">unsafeRunCmdTC</a> <a id="2671" href="Reflection.External.html#2671" class="Bound">c</a> <a id="2673" class="Symbol">=</a> <a id="2675" class="Keyword">do</a>
  <a id="2680" class="Symbol">(</a><a id="2681" href="Reflection.External.html#2681" class="Bound">exitCode</a> <a id="2690" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2692" class="Symbol">(</a><a id="2693" href="Reflection.External.html#2693" class="Bound">stdOut</a> <a id="2700" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2702" href="Reflection.External.html#2702" class="Bound">stdErr</a><a id="2708" class="Symbol">))</a>
    <a id="2715" href="Reflection.TypeChecking.Monad.Syntax.html#682" class="Function Operator">←</a> <a id="2717" href="Agda.Builtin.Reflection.External.html#304" class="Postulate">Builtin.execTC</a> <a id="2732" class="Symbol">(</a><a id="2733" href="Reflection.External.html#1272" class="Field">CmdSpec.name</a> <a id="2746" href="Reflection.External.html#2671" class="Bound">c</a><a id="2747" class="Symbol">)</a> <a id="2749" class="Symbol">(</a><a id="2750" href="Reflection.External.html#1343" class="Field">CmdSpec.args</a> <a id="2763" href="Reflection.External.html#2671" class="Bound">c</a><a id="2764" class="Symbol">)</a> <a id="2766" class="Symbol">(</a><a id="2767" href="Reflection.External.html#1410" class="Field">CmdSpec.input</a> <a id="2781" href="Reflection.External.html#2671" class="Bound">c</a><a id="2782" class="Symbol">)</a>
  <a id="2786" href="Agda.Builtin.Reflection.html#7543" class="Postulate">return</a> <a id="2793" href="Function.Base.html#1577" class="Function Operator">$</a> <a id="2795" href="Reflection.External.html#1536" class="InductiveConstructor">result</a> <a id="2802" class="Symbol">(</a><a id="2803" href="Reflection.External.html#1774" class="Function">toExitCode</a> <a id="2814" href="Reflection.External.html#2681" class="Bound">exitCode</a><a id="2822" class="Symbol">)</a> <a id="2824" href="Reflection.External.html#2693" class="Bound">stdOut</a> <a id="2831" href="Reflection.External.html#2702" class="Bound">stdErr</a>

<a id="2839" class="Keyword">macro</a>
  <a id="unsafeRunCmd"></a><a id="2847" href="Reflection.External.html#2847" class="Function">unsafeRunCmd</a> <a id="2860" class="Symbol">:</a> <a id="2862" href="Reflection.External.html#1218" class="Record">CmdSpec</a> <a id="2870" class="Symbol">→</a> <a id="2872" href="Agda.Builtin.Reflection.html#4246" class="Datatype">Term</a> <a id="2877" class="Symbol">→</a> <a id="2879" href="Agda.Builtin.Reflection.html#7500" class="Postulate">TC</a> <a id="2882" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a>
  <a id="2886" href="Reflection.External.html#2847" class="Function">unsafeRunCmd</a> <a id="2899" href="Reflection.External.html#2899" class="Bound">c</a> <a id="2901" href="Reflection.External.html#2901" class="Bound">hole</a> <a id="2906" class="Symbol">=</a> <a id="2908" href="Reflection.External.html#2619" class="Function">unsafeRunCmdTC</a> <a id="2923" href="Reflection.External.html#2899" class="Bound">c</a> <a id="2925" href="Reflection.TypeChecking.Monad.Syntax.html#682" class="Function Operator">&gt;&gt;=</a> <a id="2929" href="Agda.Builtin.Reflection.html#7673" class="Postulate">unify</a> <a id="2935" href="Reflection.External.html#2901" class="Bound">hole</a> <a id="2940" href="Function.Base.html#992" class="Function Operator">∘</a> <a id="2942" href="Reflection.External.html#2152" class="Function">quoteResult</a>

<a id="2955" class="Comment">-- |Run command from specification. If the command succeeds, it returns the</a>
<a id="3031" class="Comment">--  contents of stdout. Otherwise, it throws a type error with the contents</a>
<a id="3107" class="Comment">--  of stderr.</a>
<a id="runCmdTC"></a><a id="3122" href="Reflection.External.html#3122" class="Function">runCmdTC</a> <a id="3131" class="Symbol">:</a> <a id="3133" href="Reflection.External.html#1218" class="Record">CmdSpec</a> <a id="3141" class="Symbol">→</a> <a id="3143" href="Agda.Builtin.Reflection.html#7500" class="Postulate">TC</a> <a id="3146" class="Symbol">(</a><a id="3147" href="Reflection.External.html#799" class="Function">StdErr</a> <a id="3154" href="Data.Sum.Base.html#728" class="Datatype Operator">⊎</a> <a id="3156" href="Reflection.External.html#816" class="Function">StdOut</a><a id="3162" class="Symbol">)</a>
<a id="3164" href="Reflection.External.html#3122" class="Function">runCmdTC</a> <a id="3173" href="Reflection.External.html#3173" class="Bound">c</a> <a id="3175" class="Symbol">=</a> <a id="3177" class="Keyword">do</a>
  <a id="3182" href="Reflection.External.html#3182" class="Bound">r</a> <a id="3184" href="Reflection.TypeChecking.Monad.Syntax.html#682" class="Function Operator">←</a> <a id="3186" href="Reflection.External.html#2619" class="Function">unsafeRunCmdTC</a> <a id="3201" href="Reflection.External.html#3173" class="Bound">c</a>
  <a id="3205" class="Keyword">let</a> <a id="3209" href="Reflection.External.html#3209" class="Bound">debugPrefix</a> <a id="3221" class="Symbol">=</a> <a id="3223" class="Symbol">(</a><a id="3224" class="String">&quot;user.&quot;</a> <a id="3232" href="Data.String.Base.html#2177" class="Function Operator">++</a> <a id="3235" href="Reflection.External.html#1272" class="Field">CmdSpec.name</a> <a id="3248" href="Reflection.External.html#3173" class="Bound">c</a><a id="3249" class="Symbol">)</a>
  <a id="3253" href="Function.Base.html#3709" class="Function Operator">case</a> <a id="3258" href="Reflection.External.html#1555" class="Field">Result.exitCode</a> <a id="3274" href="Reflection.External.html#3182" class="Bound">r</a> <a id="3276" href="Function.Base.html#3709" class="Function Operator">of</a> <a id="3279" class="Symbol">λ</a>
    <a id="3285" class="Symbol">{</a> <a id="3287" href="Reflection.External.html#1101" class="InductiveConstructor">exitSuccess</a> <a id="3299" class="Symbol">→</a> <a id="3301" class="Keyword">do</a>
      <a id="3310" href="Agda.Builtin.Reflection.html#9013" class="Postulate">debugPrint</a> <a id="3321" class="Symbol">(</a><a id="3322" href="Reflection.External.html#3209" class="Bound">debugPrefix</a> <a id="3334" href="Data.String.Base.html#2177" class="Function Operator">++</a> <a id="3337" class="String">&quot;.stderr&quot;</a><a id="3346" class="Symbol">)</a> <a id="3348" class="Number">10</a> <a id="3351" class="Symbol">(</a><a id="3352" href="Agda.Builtin.Reflection.html#7199" class="InductiveConstructor">strErr</a> <a id="3359" class="Symbol">(</a><a id="3360" href="Reflection.External.html#1675" class="Field">Result.error</a> <a id="3373" href="Reflection.External.html#3182" class="Bound">r</a><a id="3374" class="Symbol">)</a> <a id="3376" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3378" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="3380" class="Symbol">)</a>
      <a id="3388" href="Agda.Builtin.Reflection.html#7543" class="Postulate">return</a> <a id="3395" href="Function.Base.html#1577" class="Function Operator">$</a> <a id="3397" href="Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="3402" class="Symbol">(</a><a id="3403" href="Reflection.External.html#1618" class="Field">Result.output</a> <a id="3417" href="Reflection.External.html#3182" class="Bound">r</a><a id="3418" class="Symbol">)</a>
    <a id="3424" class="Symbol">;</a> <a id="3426" class="Symbol">(</a><a id="3427" href="Reflection.External.html#1126" class="InductiveConstructor">exitFailure</a> <a id="3439" href="Reflection.External.html#3439" class="Bound">n</a><a id="3440" class="Symbol">)</a> <a id="3442" class="Symbol">→</a> <a id="3444" class="Keyword">do</a>
      <a id="3453" href="Agda.Builtin.Reflection.html#9013" class="Postulate">debugPrint</a> <a id="3464" class="Symbol">(</a><a id="3465" href="Reflection.External.html#3209" class="Bound">debugPrefix</a> <a id="3477" href="Data.String.Base.html#2177" class="Function Operator">++</a> <a id="3480" class="String">&quot;.stdout&quot;</a><a id="3489" class="Symbol">)</a> <a id="3491" class="Number">10</a> <a id="3494" class="Symbol">(</a><a id="3495" href="Agda.Builtin.Reflection.html#7199" class="InductiveConstructor">strErr</a> <a id="3502" class="Symbol">(</a><a id="3503" href="Reflection.External.html#1618" class="Field">Result.output</a> <a id="3517" href="Reflection.External.html#3182" class="Bound">r</a><a id="3518" class="Symbol">)</a> <a id="3520" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3522" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="3524" class="Symbol">)</a>
      <a id="3532" href="Agda.Builtin.Reflection.html#7543" class="Postulate">return</a> <a id="3539" href="Function.Base.html#1577" class="Function Operator">$</a> <a id="3541" href="Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="3546" class="Symbol">(</a><a id="3547" href="Reflection.External.html#1675" class="Field">Result.error</a> <a id="3560" href="Reflection.External.html#3182" class="Bound">r</a><a id="3561" class="Symbol">)</a>
    <a id="3567" class="Symbol">}</a>

<a id="3570" class="Keyword">macro</a>
  <a id="runCmd"></a><a id="3578" href="Reflection.External.html#3578" class="Function">runCmd</a> <a id="3585" class="Symbol">:</a> <a id="3587" href="Reflection.External.html#1218" class="Record">CmdSpec</a> <a id="3595" class="Symbol">→</a> <a id="3597" href="Agda.Builtin.Reflection.html#4246" class="Datatype">Term</a> <a id="3602" class="Symbol">→</a> <a id="3604" href="Agda.Builtin.Reflection.html#7500" class="Postulate">TC</a> <a id="3607" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a>
  <a id="3611" href="Reflection.External.html#3578" class="Function">runCmd</a> <a id="3618" href="Reflection.External.html#3618" class="Bound">c</a> <a id="3620" href="Reflection.External.html#3620" class="Bound">hole</a> <a id="3625" class="Symbol">=</a> <a id="3627" href="Reflection.External.html#3122" class="Function">runCmdTC</a> <a id="3636" href="Reflection.External.html#3618" class="Bound">c</a> <a id="3638" href="Reflection.TypeChecking.Monad.Syntax.html#682" class="Function Operator">&gt;&gt;=</a> <a id="3642" href="Data.Sum.Base.html#914" class="Function Operator">[</a> <a id="3644" href="Reflection.External.html#893" class="Function">userError</a> <a id="3654" href="Data.Sum.Base.html#914" class="Function Operator">,</a> <a id="3656" href="Agda.Builtin.Reflection.html#7673" class="Postulate">unify</a> <a id="3662" href="Reflection.External.html#3620" class="Bound">hole</a> <a id="3667" href="Function.Base.html#992" class="Function Operator">∘</a> <a id="3669" href="Agda.Builtin.Reflection.html#4719" class="InductiveConstructor">lit</a> <a id="3673" href="Function.Base.html#992" class="Function Operator">∘</a> <a id="3675" href="Agda.Builtin.Reflection.html#3808" class="InductiveConstructor">string</a> <a id="3682" href="Data.Sum.Base.html#914" class="Function Operator">]</a>
</pre></body></html>