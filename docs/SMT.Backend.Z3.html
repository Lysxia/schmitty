<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>SMT.Backend.Z3</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--allow-exec</a> <a id="26" class="Symbol">#-}</a>

<a id="31" class="Keyword">open</a> <a id="36" class="Keyword">import</a> <a id="43" href="SMT.Theory.html" class="Module">SMT.Theory</a>

<a id="55" class="Keyword">module</a> <a id="62" href="SMT.Backend.Z3.html" class="Module">SMT.Backend.Z3</a>
  <a id="79" class="Symbol">{</a><a id="80" href="SMT.Backend.Z3.html#80" class="Bound">theory</a> <a id="87" class="Symbol">:</a> <a id="89" href="SMT.Theory.html#731" class="Record">Theory</a><a id="95" class="Symbol">}</a>
  <a id="99" class="Symbol">(</a><a id="100" href="SMT.Backend.Z3.html#100" class="Bound">printable</a> <a id="110" class="Symbol">:</a> <a id="112" href="SMT.Theory.html#886" class="Record">Printable</a> <a id="122" href="SMT.Backend.Z3.html#80" class="Bound">theory</a><a id="128" class="Symbol">)</a>
  <a id="132" class="Symbol">(</a><a id="133" href="SMT.Backend.Z3.html#133" class="Bound">parsable</a> <a id="142" class="Symbol">:</a> <a id="144" href="SMT.Theory.html#1125" class="Record">Parsable</a> <a id="153" href="SMT.Backend.Z3.html#80" class="Bound">theory</a><a id="159" class="Symbol">)</a>
  <a id="163" class="Keyword">where</a>

<a id="170" class="Keyword">open</a> <a id="175" href="SMT.Theory.html#731" class="Module">Theory</a> <a id="182" href="SMT.Backend.Z3.html#80" class="Bound">theory</a>
<a id="189" class="Keyword">open</a> <a id="194" href="SMT.Theory.html#886" class="Module">Printable</a> <a id="204" href="SMT.Backend.Z3.html#100" class="Bound">printable</a>

<a id="215" class="Keyword">open</a> <a id="220" class="Keyword">import</a> <a id="227" href="SMT.Script.html" class="Module">SMT.Script</a> <a id="238" href="SMT.Backend.Z3.html#80" class="Bound">theory</a> <a id="245" class="Symbol">as</a> <a id="Script"></a><a id="248" href="SMT.Backend.Z3.html#248" class="Module">Script</a> <a id="255" class="Keyword">using</a> <a id="261" class="Symbol">(</a><a id="262" href="SMT.Script.html#4473" class="Datatype">Script</a><a id="268" class="Symbol">;</a> <a id="270" href="SMT.Script.html#3321" class="Datatype">Results</a><a id="277" class="Symbol">;</a> <a id="279" href="SMT.Script.html#566" class="Function">Ctxt</a><a id="283" class="Symbol">;</a> <a id="285" href="SMT.Script.html#2506" class="Function">OutputCtxt</a><a id="295" class="Symbol">;</a> <a id="297" href="SMT.Script.html#2412" class="Datatype">OutputType</a><a id="307" class="Symbol">)</a>
<a id="309" class="Keyword">open</a> <a id="314" href="SMT.Script.html#4707" class="Module">Script.Interaction</a> <a id="333" href="SMT.Backend.Z3.html#100" class="Bound">printable</a> <a id="343" href="SMT.Backend.Z3.html#133" class="Bound">parsable</a> <a id="352" class="Keyword">using</a> <a id="358" class="Symbol">(</a><a id="359" href="SMT.Script.html#11381" class="Function">showScript</a><a id="369" class="Symbol">;</a> <a id="371" href="SMT.Script.html#10923" class="Function">x′es</a><a id="375" class="Symbol">;</a> <a id="377" href="SMT.Script.html#12248" class="Function">parseResults</a><a id="389" class="Symbol">;</a> <a id="391" href="SMT.Script.html#12931" class="Function">quoteResults</a><a id="403" class="Symbol">)</a>
<a id="405" class="Keyword">open</a> <a id="410" class="Keyword">import</a> <a id="417" href="Data.List.html" class="Module">Data.List</a> <a id="427" class="Symbol">as</a> <a id="430" class="Module">List</a> <a id="435" class="Keyword">using</a> <a id="441" class="Symbol">(</a><a id="442" href="Agda.Builtin.List.html#148" class="Datatype">List</a><a id="446" class="Symbol">;</a> <a id="448" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">_∷_</a><a id="451" class="Symbol">;</a> <a id="453" href="Data.List.Base.html#9981" class="InductiveConstructor">[]</a><a id="455" class="Symbol">)</a>
<a id="457" class="Keyword">open</a> <a id="462" class="Keyword">import</a> <a id="469" href="Data.Maybe.html" class="Module">Data.Maybe</a> <a id="480" class="Symbol">as</a> <a id="483" class="Module">Maybe</a> <a id="489" class="Keyword">using</a> <a id="495" class="Symbol">(</a><a id="496" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a><a id="501" class="Symbol">;</a> <a id="503" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a><a id="507" class="Symbol">;</a> <a id="509" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a><a id="516" class="Symbol">)</a>
<a id="518" class="Keyword">open</a> <a id="523" class="Keyword">import</a> <a id="530" href="Data.String.html" class="Module">Data.String</a> <a id="542" class="Symbol">as</a> <a id="545" class="Module">String</a> <a id="552" class="Keyword">using</a> <a id="558" class="Symbol">(</a><a id="559" href="Agda.Builtin.String.html#336" class="Postulate">String</a><a id="565" class="Symbol">;</a> <a id="567" href="Data.String.Base.html#2177" class="Function Operator">_++_</a><a id="571" class="Symbol">)</a>
<a id="573" class="Keyword">open</a> <a id="578" class="Keyword">import</a> <a id="585" href="Data.Sum.html" class="Module">Data.Sum</a> <a id="594" class="Symbol">as</a> <a id="597" class="Module">Sum</a> <a id="601" class="Keyword">using</a> <a id="607" class="Symbol">(</a><a id="608" href="Data.Sum.Base.html#728" class="Datatype Operator">_⊎_</a><a id="611" class="Symbol">;</a> <a id="613" href="Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a><a id="617" class="Symbol">;</a> <a id="619" href="Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a><a id="623" class="Symbol">;</a> <a id="625" href="Data.Sum.Base.html#914" class="Function Operator">[_,_]</a><a id="630" class="Symbol">)</a>
<a id="632" class="Keyword">open</a> <a id="637" class="Keyword">import</a> <a id="644" href="Data.Unit.html" class="Module">Data.Unit</a> <a id="654" class="Symbol">as</a> <a id="657" class="Module">Unit</a> <a id="662" class="Keyword">using</a> <a id="668" class="Symbol">(</a><a id="669" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a><a id="670" class="Symbol">)</a>
<a id="672" class="Keyword">open</a> <a id="677" class="Keyword">import</a> <a id="684" href="Function.html" class="Module">Function</a> <a id="693" class="Keyword">using</a> <a id="699" class="Symbol">(</a><a id="700" href="Function.Base.html#3709" class="Function Operator">case_of_</a><a id="708" class="Symbol">;</a> <a id="710" href="Function.Base.html#636" class="Function">const</a><a id="715" class="Symbol">;</a> <a id="717" href="Function.Base.html#1577" class="Function Operator">_$_</a><a id="720" class="Symbol">;</a> <a id="722" href="Function.Base.html#992" class="Function Operator">_∘_</a><a id="725" class="Symbol">)</a>
<a id="727" class="Keyword">open</a> <a id="732" class="Keyword">import</a> <a id="739" href="Reflection.html" class="Module">Reflection</a>
<a id="750" class="Keyword">open</a> <a id="755" class="Keyword">import</a> <a id="762" href="Reflection.External.html" class="Module">Reflection.External</a>
<a id="782" class="Keyword">open</a> <a id="787" class="Keyword">import</a> <a id="794" href="Text.Parser.String.html" class="Module">Text.Parser.String</a>

<a id="814" class="Keyword">private</a>
  <a id="824" class="Keyword">variable</a>
    <a id="837" href="SMT.Backend.Z3.html#837" class="Generalizable">Γ</a> <a id="839" class="Symbol">:</a> <a id="841" href="SMT.Script.html#566" class="Function">Ctxt</a>
    <a id="850" href="SMT.Backend.Z3.html#850" class="Generalizable">ξ</a> <a id="852" class="Symbol">:</a> <a id="854" href="SMT.Script.html#2412" class="Datatype">OutputType</a>
    <a id="869" href="SMT.Backend.Z3.html#869" class="Generalizable">Ξ</a> <a id="871" class="Symbol">:</a> <a id="873" href="SMT.Script.html#2506" class="Function">OutputCtxt</a>

<a id="mkZ3Cmd"></a><a id="885" href="SMT.Backend.Z3.html#885" class="Function">mkZ3Cmd</a> <a id="893" class="Symbol">:</a> <a id="895" href="SMT.Script.html#4473" class="Datatype">Script</a> <a id="902" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="905" href="SMT.Backend.Z3.html#837" class="Generalizable">Γ</a> <a id="907" href="SMT.Backend.Z3.html#869" class="Generalizable">Ξ</a> <a id="909" class="Symbol">→</a> <a id="911" href="Reflection.External.html#1218" class="Record">CmdSpec</a>
<a id="919" href="Reflection.External.html#1272" class="Field">CmdSpec.name</a>  <a id="933" class="Symbol">(</a><a id="934" href="SMT.Backend.Z3.html#885" class="Function">mkZ3Cmd</a> <a id="942" class="Symbol">_)</a>    <a id="948" class="Symbol">=</a> <a id="950" class="String">&quot;z3&quot;</a>
<a id="955" href="Reflection.External.html#1343" class="Field">CmdSpec.args</a>  <a id="969" class="Symbol">(</a><a id="970" href="SMT.Backend.Z3.html#885" class="Function">mkZ3Cmd</a> <a id="978" class="Symbol">_)</a>    <a id="984" class="Symbol">=</a> <a id="986" class="String">&quot;-smt2&quot;</a> <a id="994" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="996" class="String">&quot;-in&quot;</a> <a id="1002" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1004" class="String">&quot;-v:0&quot;</a> <a id="1011" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1013" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>
<a id="1016" href="Reflection.External.html#1410" class="Field">CmdSpec.input</a> <a id="1030" class="Symbol">(</a><a id="1031" href="SMT.Backend.Z3.html#885" class="Function">mkZ3Cmd</a> <a id="1039" href="SMT.Backend.Z3.html#1039" class="Bound">cmds</a><a id="1043" class="Symbol">)</a> <a id="1045" class="Symbol">=</a> <a id="1047" href="SMT.Script.html#11381" class="Function">showScript</a> <a id="1058" href="SMT.Script.html#10923" class="Function">x′es</a> <a id="1063" href="SMT.Backend.Z3.html#1039" class="Bound">cmds</a>

<a id="parseError"></a><a id="1069" href="SMT.Backend.Z3.html#1069" class="Function">parseError</a> <a id="1080" class="Symbol">:</a> <a id="1082" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="1089" class="Symbol">→</a> <a id="1091" href="Text.Parser.String.html#1370" class="Datatype">ErrorMsg</a> <a id="1100" class="Symbol">→</a>  <a id="1103" href="Agda.Builtin.Reflection.html#7500" class="Postulate">TC</a> <a id="1106" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a>
<a id="1108" href="SMT.Backend.Z3.html#1069" class="Function">parseError</a> <a id="1119" href="SMT.Backend.Z3.html#1119" class="Bound">str</a> <a id="1123" href="Text.Parser.String.html#1393" class="InductiveConstructor">no-parse</a>
  <a id="1134" class="Symbol">=</a> <a id="1136" href="Reflection.External.html#893" class="Function">userError</a> <a id="1146" href="Function.Base.html#1577" class="Function Operator">$</a> <a id="1148" class="String">&quot;Failed to parse Z3 output:\n&quot;</a> <a id="1179" href="Data.String.Base.html#2177" class="Function Operator">++</a> <a id="1182" href="SMT.Backend.Z3.html#1119" class="Bound">str</a>
<a id="1186" href="SMT.Backend.Z3.html#1069" class="Function">parseError</a> <a id="1197" href="SMT.Backend.Z3.html#1197" class="Bound">str</a> <a id="1201" href="Text.Parser.String.html#1422" class="InductiveConstructor">ambiguous-parse</a>
  <a id="1219" class="Symbol">=</a> <a id="1221" href="Reflection.External.html#893" class="Function">userError</a> <a id="1231" href="Function.Base.html#1577" class="Function Operator">$</a> <a id="1233" class="String">&quot;Ambiguous parse:\n&quot;</a> <a id="1254" href="Data.String.Base.html#2177" class="Function Operator">++</a> <a id="1257" href="SMT.Backend.Z3.html#1197" class="Bound">str</a>

<a id="1262" class="Keyword">macro</a>
  <a id="runZ3"></a><a id="1270" href="SMT.Backend.Z3.html#1270" class="Function">runZ3</a> <a id="1276" class="Symbol">:</a> <a id="1278" href="SMT.Script.html#4473" class="Datatype">Script</a> <a id="1285" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="1288" href="SMT.Backend.Z3.html#837" class="Generalizable">Γ</a> <a id="1290" class="Symbol">(</a><a id="1291" href="SMT.Backend.Z3.html#850" class="Generalizable">ξ</a> <a id="1293" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1295" href="SMT.Backend.Z3.html#869" class="Generalizable">Ξ</a><a id="1296" class="Symbol">)</a> <a id="1298" class="Symbol">→</a> <a id="1300" href="Agda.Builtin.Reflection.html#4246" class="Datatype">Term</a> <a id="1305" class="Symbol">→</a> <a id="1307" href="Agda.Builtin.Reflection.html#7500" class="Postulate">TC</a> <a id="1310" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a>
  <a id="1314" href="SMT.Backend.Z3.html#1270" class="Function">runZ3</a> <a id="1320" class="Symbol">{</a><a id="1321" href="SMT.Backend.Z3.html#1321" class="Bound">Γ</a><a id="1322" class="Symbol">}</a> <a id="1324" class="Symbol">{</a><a id="1325" href="SMT.Backend.Z3.html#1325" class="Bound">ξ</a><a id="1326" class="Symbol">}</a> <a id="1328" class="Symbol">{</a><a id="1329" href="SMT.Backend.Z3.html#1329" class="Bound">Ξ</a><a id="1330" class="Symbol">}</a> <a id="1332" href="SMT.Backend.Z3.html#1332" class="Bound">scr</a> <a id="1336" href="SMT.Backend.Z3.html#1336" class="Bound">hole</a> <a id="1341" class="Symbol">=</a>
    <a id="1347" href="Reflection.External.html#3122" class="Function">runCmdTC</a> <a id="1356" class="Symbol">(</a><a id="1357" href="SMT.Backend.Z3.html#885" class="Function">mkZ3Cmd</a> <a id="1365" href="SMT.Backend.Z3.html#1332" class="Bound">scr</a><a id="1368" class="Symbol">)</a> <a id="1370" href="Reflection.TypeChecking.Monad.Syntax.html#682" class="Function Operator">&gt;&gt;=</a>
      <a id="1380" href="Data.Sum.Base.html#914" class="Function Operator">[</a> <a id="1382" href="Reflection.External.html#893" class="Function">userError</a>
      <a id="1398" href="Data.Sum.Base.html#914" class="Function Operator">,</a> <a id="1400" class="Symbol">(λ</a> <a id="1403" href="SMT.Backend.Z3.html#1403" class="Bound">str</a> <a id="1407" class="Symbol">→</a> <a id="1409" href="Data.Sum.Base.html#914" class="Function Operator">[</a> <a id="1411" href="SMT.Backend.Z3.html#1069" class="Function">parseError</a> <a id="1422" href="SMT.Backend.Z3.html#1403" class="Bound">str</a> <a id="1426" href="Data.Sum.Base.html#914" class="Function Operator">,</a> <a id="1428" href="Agda.Builtin.Reflection.html#7673" class="Postulate">unify</a> <a id="1434" href="SMT.Backend.Z3.html#1336" class="Bound">hole</a> <a id="1439" href="Function.Base.html#992" class="Function Operator">∘</a> <a id="1441" href="SMT.Script.html#12931" class="Function">quoteResults</a> <a id="1454" href="Data.Sum.Base.html#914" class="Function Operator">]</a> <a id="1456" href="Function.Base.html#1577" class="Function Operator">$</a> <a id="1458" href="Text.Parser.String.html#2525" class="Function">runParser</a> <a id="1468" class="Symbol">(</a><a id="1469" href="SMT.Script.html#12248" class="Function">parseResults</a> <a id="1482" href="SMT.Backend.Z3.html#1325" class="Bound">ξ</a> <a id="1484" href="SMT.Backend.Z3.html#1329" class="Bound">Ξ</a><a id="1485" class="Symbol">)</a> <a id="1487" href="SMT.Backend.Z3.html#1403" class="Bound">str</a><a id="1490" class="Symbol">)</a> <a id="1492" href="Data.Sum.Base.html#914" class="Function Operator">]</a>
</pre></body></html>